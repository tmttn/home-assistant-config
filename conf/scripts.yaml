---
start_speakers:
  description: "Start a Spotify playlist on KEF speakers"
  fields:
    volume:
      description: "Volume at which to play"
      example: "0.3"
    source:
      description: "Which source to use on the speakers"
      example: "Wifi"
  sequence:
    - service: media_player.turn_on
      entity_id: media_player.kef
    - service: media_player.select_source
      entity_id: media_player.kef
      data_template:
        source: "{{ source }}"
    - wait_template: "{{ is_state('media_player.kef', 'on') }}"
      timeout: "00:01:00"
      continue_on_timeout: "false"
    - service: media_player.volume_set
      entity_id: media_player.kef
      data_template:
        volume_level: "{{ volume }}"

start_spotify:
  description: "Start a Spotify playlist on KEF speakers"
  fields:
    source:
      description: "The name of the speaker as it appears in Spotify"
      example: "KEF LS50 Wireless"
    playlist:
      description: "The playlist URI from Spotify"
      example: "6rPTm9dYftKcFAfwyRqmDZ"
  sequence:
    - service: homeassistant.update_entity
      entity_id: media_player.spotify
    - wait_template: "{{ source in state_attr('media_player.spotify', 'source_list')  }}"
      timeout: "00:01:00"
      continue_on_timeout: "false"
    - service: media_player.select_source
      entity_id: media_player.spotify
      data_template:
        source: "{{ source }}"
    - service: spotify.play_playlist
      data_template:
        media_content_id: "spotify:playlist:{{ playlist }}"
        random_song: true
    - service: media_player.media_play
      entity_id: media_player.spotify

start_vacuum_cleaning:
  alias: "Start the vacuum"
  sequence:
    - service: vacuum.start
      entity_id: vacuum.xiaomi_vacuum_cleaner
